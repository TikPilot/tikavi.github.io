const translations = {
    zh: {
        nav_contact: "联系我们",
        hero_headline: "让中国商家在美国与日本 TikTok 轻松起飞",
        hero_subheadline: "TikAvi 为跨境商家提供 <span class=\"highlight\">高端轻代运营 + 自动化增长系统</span>，<br>覆盖店铺开通、商品上架、达人推广与数据增长，<br>帮助你的品牌快速在 TikTok 赢得销量与市场。",
        hero_bullet_1: "美国 & 日本 TikTok Shop 全托管",
        hero_bullet_2: "高端轻代运营：更省、效率更高",
        hero_bullet_3: "达人推广系统化管理",
        hero_bullet_4: "自动化工具降低成本、提升增长",
        hero_bullet_5: "专业策略团队打造可复制增长模型",
        hero_cta: "预约免费咨询 →",
        features_title: "核心功能模块",
        feature_1_title: "跨境 TikTok 店铺开通",
        feature_1_desc: "一站式解决资料、审核、税务、收款等复杂流程。",
        feature_1_list_1: "TikAvi 负责为你开设美国与日本 TikTok Shop",
        feature_1_list_2: "确保店铺安全稳健上线",
        feature_1_list_3: "避免不必要的风险与延误",
        feature_1_footer: "你需要做的只是一件事：提供基础信息，我们帮你搞定全部流程。",
        feature_2_title: "商品上架与内容优化",
        feature_2_desc: "高标准 Listing，让你的产品在 TikTok 更容易被发现与购买。",
        feature_2_list_1: "英文/日文标题 SEO 生成",
        feature_2_list_2: "商品描述优化",
        feature_2_list_3: "标签 & 类目配置",
        feature_2_list_4: "SKU 结构搭建",
        feature_2_list_5: "主图/视频合规检查",
        feature_3_title: "达人推广 (Affiliate Engine)",
        feature_3_desc: "全流程达人合作体系，让内容驱动 GMV 成为可复制能力。",
        feature_3_list_1: "达人筛选 & 批量推品",
        feature_3_list_2: "佣金策略建议",
        feature_3_list_3: "样品管理",
        feature_3_list_4: "达人带货效果跟踪",
        feature_3_footer: "借助 TikAvi 的自动化推品系统，你的产品可以同时触达数百名海外达人。",
        feature_4_title: "TikAvi OS (自动化增长系统)",
        feature_4_desc: "TikAvi 的核心竞争力来自技术能力。",
        feature_4_list_1: "<strong>Listing AutoGen:</strong> 自动生成标题、描述与关键词",
        feature_4_list_2: "<strong>Affiliate Push Engine:</strong> 自动向达人推品",
        feature_4_list_3: "<strong>Insights Board:</strong> 实时监控关键指标",
        feature_4_list_4: "<strong>Auto-SOP Scheduler:</strong> 自动提醒运营节点",
        feature_4_list_5: "<strong>Report Builder:</strong> 自动生成日报/周报",
        why_title: "Why TikAvi?",
        why_1_title: "✔ 专注美国 & 日本",
        why_1_desc: "深入研究平台机制、达人生态与增长模型。",
        why_2_title: "✔ 轻代运营模式",
        why_2_desc: "相比传统代运营，TikAvi 更关注效率 + 技术驱动，成本更优。",
        why_3_title: "✔ 自动化增长",
        why_3_desc: "所有 SOP 会逐步进入自动化系统，让你的生意更稳、更快。",
        why_4_title: "✔ 数据驱动",
        why_4_desc: "每个决策基于真实数据，而非拍脑袋。",
        footer_title: "Ready to Fly?",
        footer_cta: "立即预约咨询",
        modal_title: "预约免费咨询",
        modal_subtitle: "填写下方信息，我们将在 24 小时内与你联系。",
        form_name: "姓名",
        form_phone: "电话 (必填)",
        form_contact: "其他联系方式 (微信/Email/WhatsApp - 选填)",
        form_company: "公司/品牌名称",
        form_message: "咨询内容 (选填)",
        form_submit: "提交申请"
    },
    en: {
        nav_contact: "Contact Us",
        hero_headline: "Launch Your TikTok Business in US & Japan with Ease",
        hero_subheadline: "TikAvi provides <span class=\"highlight\">Premium Light-Agency Services + Automated Growth Systems</span>,<br>covering shop setup, listing optimization, affiliate marketing, and data growth,<br>helping your brand quickly win sales and market share on TikTok.",
        hero_bullet_1: "US & Japan TikTok Shop Full Management",
        hero_bullet_2: "Premium Light-Agency: Lower Cost, Higher Efficiency",
        hero_bullet_3: "Systematic Affiliate Management",
        hero_bullet_4: "Automation Tools to Lower Costs & Boost Growth",
        hero_bullet_5: "Professional Strategy Team Building Replicable Growth Models",
        hero_cta: "Book Free Consultation →",
        features_title: "Core Features",
        feature_1_title: "Cross-border TikTok Shop Setup",
        feature_1_desc: "One-stop solution for documentation, audit, tax, and payment processes.",
        feature_1_list_1: "TikAvi sets up your US & Japan TikTok Shop",
        feature_1_list_2: "Ensuring safe and steady launch",
        feature_1_list_3: "Avoiding unnecessary risks and delays",
        feature_1_footer: "You only need to do one thing: provide basic info, we handle the rest.",
        feature_2_title: "Listing Optimization",
        feature_2_desc: "High-standard Listings to make your products easier to find and buy on TikTok.",
        feature_2_list_1: "English/Japanese Title SEO Generation",
        feature_2_list_2: "Product Description Optimization",
        feature_2_list_3: "Tag & Category Configuration",
        feature_2_list_4: "SKU Structure Setup",
        feature_2_list_5: "Main Image/Video Compliance Check",
        feature_3_title: "Affiliate Engine",
        feature_3_desc: "Full-process affiliate cooperation system, making content-driven GMV a replicable capability.",
        feature_3_list_1: "Affiliate Screening & Batch Pitching",
        feature_3_list_2: "Commission Strategy Advice",
        feature_3_list_3: "Sample Management",
        feature_3_list_4: "Performance Tracking",
        feature_3_footer: "With TikAvi's automated pitch system, your product can reach hundreds of overseas creators simultaneously.",
        feature_4_title: "TikAvi OS (Automated Growth System)",
        feature_4_desc: "TikAvi's core competitiveness comes from technical capability.",
        feature_4_list_1: "<strong>Listing AutoGen:</strong> Automatically generate titles, descriptions, and keywords",
        feature_4_list_2: "<strong>Affiliate Push Engine:</strong> Automatically pitch to creators",
        feature_4_list_3: "<strong>Insights Board:</strong> Real-time monitoring of key metrics",
        feature_4_list_4: "<strong>Auto-SOP Scheduler:</strong> Automatic reminders for operation nodes",
        feature_4_list_5: "<strong>Report Builder:</strong> Automatic daily/weekly reports",
        why_title: "Why TikAvi?",
        why_1_title: "✔ Focus on US & Japan",
        why_1_desc: "Deep research into platform mechanisms, creator ecology, and growth models.",
        why_2_title: "✔ Light-Agency Mode",
        why_2_desc: "Compared to traditional agencies, TikAvi focuses more on efficiency + technology, with better costs.",
        why_3_title: "✔ Automated Growth",
        why_3_desc: "All SOPs will gradually enter the automation system, making your business more stable and faster.",
        why_4_title: "✔ Data Driven",
        why_4_desc: "Every decision is based on real data, not guesswork.",
        footer_title: "Ready to Fly?",
        footer_cta: "Book Consultation Now",
        modal_title: "Book Free Consultation",
        modal_subtitle: "Fill in the form below, we'll contact you within 24 hours.",
        form_name: "Name",
        form_phone: "Phone (Required)",
        form_contact: "Other Contact (WeChat/Email/WhatsApp - Optional)",
        form_company: "Company Name",
        form_message: "Message (Optional)",
        form_submit: "Submit"
    }
};

function switchLanguage(lang) {
    const elements = document.querySelectorAll('[data-i18n]');
    elements.forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            // Check if the content contains HTML tags
            if (translations[lang][key].includes('<')) {
                element.innerHTML = translations[lang][key];
            } else {
                element.textContent = translations[lang][key];
            }
        }
    });

    // Update active state of buttons
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-lang') === lang) {
            btn.classList.add('active');
        }
    });

    // Update html lang attribute
    document.documentElement.lang = lang === 'zh' ? 'zh-CN' : 'en';

    // Save preference
    localStorage.setItem('tikavi_lang', lang);
}

document.addEventListener('DOMContentLoaded', () => {
    // Check for saved preference or default to browser language
    const savedLang = localStorage.getItem('tikavi_lang');
    const browserLang = navigator.language.startsWith('zh') ? 'zh' : 'en';
    const initialLang = savedLang || browserLang;

    switchLanguage(initialLang);

    // Add event listeners to language buttons
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');
            switchLanguage(lang);
        });
    });

    // Modal Logic
    const modal = document.getElementById('contactModal');
    const modalClose = document.getElementById('modalClose');
    const contactForm = document.getElementById('contactForm');
    const consultationBtns = document.querySelectorAll('a[href^="mailto:"]');

    // Attach click event to all consultation buttons
    consultationBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            modal.classList.add('active');
        });
    });

    // Close modal
    if (modalClose) {
        modalClose.addEventListener('click', () => {
            modal.classList.remove('active');
        });
    }

    // Close on click outside
    if (modal) {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
            }
        });
    }

    // Form Submission (Formspree with Mailto Fallback)
    if (contactForm) {
        contactForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const submitBtn = contactForm.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.textContent;
            submitBtn.textContent = 'Sending...';
            submitBtn.disabled = true;

            const name = document.getElementById('name').value;
            const phone = document.getElementById('phone').value;
            const contact = document.getElementById('contact').value;
            const company = document.getElementById('company').value;
            const message = document.getElementById('message').value;

            // Helper to trigger mailto fallback
            const triggerMailto = () => {
                const subject = `TikAvi Consultation Request - ${name}`;
                const body = `Name: ${name}%0D%0APhone: ${phone}%0D%0AOther Contact: ${contact}%0D%0ACompany: ${company}%0D%0AMessage: ${message}%0D%0A%0D%0ASent via TikAvi.com`;
                window.location.href = `mailto:tikavi2048@gmail.com?subject=${subject}&body=${body}`;
                alert("We couldn't reach the server, so we opened your email client instead. Please hit send!");
            };

            const formData = new FormData(contactForm);

            try {
                // If ID is still placeholder, skip straight to fallback
                if (contactForm.action.includes('PLACEHOLDER_ID')) {
                    throw new Error('Formspree ID not configured');
                }

                const response = await fetch(contactForm.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (response.ok) {
                    modal.classList.remove('active');
                    alert("Thanks! We have received your request and will contact you shortly.");
                    contactForm.reset();
                } else {
                    // If service error, fallback to mailto
                    triggerMailto();
                }
            } catch (error) {
                console.log('Form submission error:', error);
                triggerMailto();
            } finally {
                submitBtn.textContent = originalBtnText;
                submitBtn.disabled = false;
            }
        });
    }
});
